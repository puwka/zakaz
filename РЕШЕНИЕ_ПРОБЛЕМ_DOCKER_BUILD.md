# üîß –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º –ø—Ä–∏ —Å–±–æ—Ä–∫–µ Docker –æ–±—Ä–∞–∑–∞

## ‚ùå –ü—Ä–æ–±–ª–µ–º–∞ 1: –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –Ω–µ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –≤ build

**–°–∏–º–ø—Ç–æ–º—ã:**
```
WARNING: The NEXT_PUBLIC_SUPABASE_URL variable is not set. Defaulting to a blank string.
WARNING: The NEXT_PUBLIC_SUPABASE_ANON_KEY variable is not set. Defaulting to a blank string.
```

**–ü—Ä–∏—á–∏–Ω–∞:** –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –Ω–µ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –≤ –ø—Ä–æ—Ü–µ—Å—Å —Å–±–æ—Ä–∫–∏ Docker –æ–±—Ä–∞–∑–∞.

**–†–µ—à–µ–Ω–∏–µ:** ‚úÖ **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ `docker-compose.yml`**

–§–∞–π–ª `docker-compose.yml` –æ–±–Ω–æ–≤–ª–µ–Ω - —Ç–µ–ø–µ—Ä—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ `args` –≤ —Å–µ–∫—Ü–∏—é `build`.

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
```bash
cd /var/www/derevo
cat docker-compose.yml | grep -A 5 "build:"
```

–î–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Å–µ–∫—Ü–∏—è `args:` —Å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –æ–∫—Ä—É–∂–µ–Ω–∏—è.

---

## ‚ùå –ü—Ä–æ–±–ª–µ–º–∞ 2: –û—à–∏–±–∫–∞ —Å–µ—Ç–∏ –ø—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ –ø–∞–∫–µ—Ç–æ–≤ Alpine

**–°–∏–º–ø—Ç–æ–º—ã:**
```
WARNING: fetching https://dl-cdn.alpinelinux.org/alpine/v3.23/main/x86_64/APKINDEX.tar.gz: TLS: unspecified error
ERROR: unable to select packages: libc6-compat (no such package)
```

**–ü—Ä–∏—á–∏–Ω–∞:** –°–µ—Ä–≤–µ—Ä –Ω–µ –º–æ–∂–µ—Ç –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è–º Alpine Linux (—Ç–∞ –∂–µ –ø—Ä–æ–±–ª–µ–º–∞, —á—Ç–æ –±—ã–ª–∞ —Å get.docker.com).

**–†–µ—à–µ–Ω–∏—è:**

### –†–µ—à–µ–Ω–∏–µ 1: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥—Ä—É–≥–æ–π –±–∞–∑–æ–≤—ã–π –æ–±—Ä–∞–∑ (–†–ï–ö–û–ú–ï–ù–î–£–ï–¢–°–Ø) ‚≠ê

–ó–∞–º–µ–Ω–∏—Ç–µ Alpine –Ω–∞ –æ–±—ã—á–Ω—ã–π Debian –æ–±—Ä–∞–∑, –∫–æ—Ç–æ—Ä—ã–π –Ω–µ —Ç—Ä–µ–±—É–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –ø–∞–∫–µ—Ç–æ–≤:

**–û–±–Ω–æ–≤–∏—Ç–µ `Dockerfile`:**

```dockerfile
# –ò—Å–ø–æ–ª—å–∑—É–µ–º –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π –æ–±—Ä–∞–∑ Node.js (Debian-based)
FROM node:20-slim AS base

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –æ–Ω–∏ –Ω—É–∂–Ω—ã
FROM base AS deps
WORKDIR /app
```

**–ü–æ–ª–Ω—ã–π –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π Dockerfile:**

```dockerfile
# –ò—Å–ø–æ–ª—å–∑—É–µ–º –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π –æ–±—Ä–∞–∑ Node.js (Debian-based, –Ω–µ —Ç—Ä–µ–±—É–µ—Ç libc6-compat)
FROM node:20-slim AS base

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –æ–Ω–∏ –Ω—É–∂–Ω—ã
FROM base AS deps
WORKDIR /app

# –ö–æ–ø–∏—Ä—É–µ–º —Ñ–∞–π–ª—ã –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
COPY package.json package-lock.json* ./
RUN npm ci

# –°–æ–±–∏—Ä–∞–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
FROM base AS builder
WORKDIR /app
COPY --from=deps /app/node_modules ./node_modules
COPY . .

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è —Å–±–æ—Ä–∫–∏
ENV NEXT_TELEMETRY_DISABLED 1

# –°–æ–±–∏—Ä–∞–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
RUN npm run build

# Production –æ–±—Ä–∞–∑
FROM base AS runner
WORKDIR /app

ENV NODE_ENV production
ENV NEXT_TELEMETRY_DISABLED 1

RUN groupadd --system --gid 1001 nodejs
RUN useradd --system --uid 1001 nextjs

# –ö–æ–ø–∏—Ä—É–µ–º –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —Ñ–∞–π–ª—ã –∏–∑ standalone —Å–±–æ—Ä–∫–∏
COPY --from=builder --chown=nextjs:nodejs /app/public ./public
COPY --from=builder --chown=nextjs:nodejs /app/.next/standalone ./
COPY --from=builder --chown=nextjs:nodejs /app/.next/static ./.next/static

USER nextjs

EXPOSE 3000

ENV PORT 3000
ENV HOSTNAME "0.0.0.0"

CMD ["node", "server.js"]
```

**–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ:**
```bash
cd /var/www/derevo
nano Dockerfile
# –ó–∞–º–µ–Ω–∏—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –Ω–∞ –≤–µ—Ä—Å–∏—é –≤—ã—à–µ
# –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ: Ctrl+O, Enter, Ctrl+X
```

### –†–µ—à–µ–Ω–∏–µ 2: –ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å —É—Å—Ç–∞–Ω–æ–≤–∫—É libc6-compat (–≤—Ä–µ–º–µ–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ)

Dockerfile —É–∂–µ –æ–±–Ω–æ–≤–ª–µ–Ω - —Ç–µ–ø–µ—Ä—å —É—Å—Ç–∞–Ω–æ–≤–∫–∞ libc6-compat –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–∞. –ï—Å–ª–∏ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è - —Å–±–æ—Ä–∫–∞ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—Å—è.

**–ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–æ–±—Ä–∞—Ç—å —Å–Ω–æ–≤–∞:**
```bash
cd /var/www/derevo
docker-compose build
```

### –†–µ—à–µ–Ω–∏–µ 3: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç
ping -c 4 8.8.8.8

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤ Alpine
curl -I https://dl-cdn.alpinelinux.org
```

**–ï—Å–ª–∏ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–µ—Ç–∏ –≤ Proxmox
- –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –ø—Ä–æ–≤–∞–π–¥–µ—Ä—É VDS

### –†–µ—à–µ–Ω–∏–µ 4: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–æ–∫—Å–∏ (–µ—Å–ª–∏ –µ—Å—Ç—å)

–ï—Å–ª–∏ —É –≤–∞—Å –µ—Å—Ç—å –ø—Ä–æ–∫—Å–∏-—Å–µ—Ä–≤–µ—Ä:

```bash
# –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø—Ä–æ–∫—Å–∏ –¥–ª—è Docker
mkdir -p /etc/systemd/system/docker.service.d
cat > /etc/systemd/system/docker.service.d/http-proxy.conf << EOF
[Service]
Environment="HTTP_PROXY=http://–ø—Ä–æ–∫—Å–∏:–ø–æ—Ä—Ç"
Environment="HTTPS_PROXY=http://–ø—Ä–æ–∫—Å–∏:–ø–æ—Ä—Ç"
EOF

systemctl daemon-reload
systemctl restart docker
```

---

## ‚úÖ –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π –ø–æ—Ä—è–¥–æ–∫ –¥–µ–π—Å—Ç–≤–∏–π

1. **–û–±–Ω–æ–≤–∏—Ç–µ Dockerfile** (–†–µ—à–µ–Ω–∏–µ 1) - –∑–∞–º–µ–Ω–∏—Ç–µ `node:20-alpine` –Ω–∞ `node:20-slim`
2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ `.env.production` –∑–∞–ø–æ–ª–Ω–µ–Ω:**
   ```bash
   cat /var/www/derevo/.env.production
   ```
3. **–ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–æ–±—Ä–∞—Ç—å —Å–Ω–æ–≤–∞:**
   ```bash
   cd /var/www/derevo
   docker-compose build
   ```

---

## üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è:

```bash
cd /var/www/derevo
cat .env.production
```

**–î–æ–ª–∂–Ω—ã –±—ã—Ç—å –∑–∞–ø–æ–ª–Ω–µ–Ω—ã –≤—Å–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ.**

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞:

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ ping
ping -c 4 8.8.8.8

# –ü—Ä–æ–≤–µ—Ä–∫–∞ HTTPS
curl -I https://www.google.com

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤ Alpine
curl -I https://dl-cdn.alpinelinux.org
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ Docker:

```bash
# –°—Ç–∞—Ç—É—Å Docker
systemctl status docker

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã Docker
docker ps
```

---

## üí° –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

```bash
# –û—á–∏—Å—Ç–∫–∞ Docker –∫—ç—à–∞ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
docker system prune -a

# –ü–µ—Ä–µ—Å–±–æ—Ä–∫–∞ –±–µ–∑ –∫—ç—à–∞
docker-compose build --no-cache

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ —Å–±–æ—Ä–∫–∏
docker-compose build 2>&1 | tee build.log
cat build.log
```

---

## ‚úÖ –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

–ü–æ—Å–ª–µ —Ç–æ–≥–æ, –∫–∞–∫ –ø—Ä–æ–±–ª–µ–º—ã —Ä–µ—à–µ–Ω—ã:

1. **–°–æ–±–µ—Ä–∏—Ç–µ –æ–±—Ä–∞–∑:**
   ```bash
   cd /var/www/derevo
   docker-compose build
   ```

2. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä:**
   ```bash
   docker-compose up -d
   ```

3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å:**
   ```bash
   docker-compose ps
   ```

4. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏:**
   ```bash
   docker-compose logs -f
   ```

---

## üìû –ï—Å–ª–∏ –Ω–∏—á–µ–≥–æ –Ω–µ –ø–æ–º–æ–≥–∞–µ—Ç

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ —Å–±–æ—Ä–∫–∏:**
   ```bash
   docker-compose build 2>&1 | tee build.log
   cat build.log
   ```

2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø–Ω–æ–µ –º–µ—Å—Ç–æ –Ω–∞ –¥–∏—Å–∫–µ:**
   ```bash
   df -h
   ```

3. **–û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –ø—Ä–æ–≤–∞–π–¥–µ—Ä—É VDS:**
   - –°–æ–æ–±—â–∏—Ç–µ –æ –ø—Ä–æ–±–ª–µ–º–∞—Ö —Å –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ–º
   - –ü–æ–ø—Ä–æ—Å–∏—Ç–µ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–µ—Ç–∏

---

## ‚úÖ –ì–æ—Ç–æ–≤–æ!

–ü–æ—Å–ª–µ —Ä–µ—à–µ–Ω–∏—è –ø—Ä–æ–±–ª–µ–º –ø—Ä–æ–¥–æ–ª–∂–∞–π—Ç–µ —Å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏:
- –®–∞–≥ 6: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤–µ–±-—Å–µ—Ä–≤–µ—Ä–∞ (Nginx)
- –ò–ª–∏ —Å–ª–µ–¥—É—é—â–∏–π —à–∞–≥ –∏–∑ **–ò–ù–°–¢–†–£–ö–¶–ò–Ø_–í–ï–ë_–ö–û–ù–°–û–õ–¨.md**

**–£–¥–∞—á–∏! üöÄ**


