# üîß –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º –ø—Ä–∏ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–∏

## ‚ùå –ü—Ä–æ–±–ª–µ–º–∞: –ù–µ –º–æ–≥—É –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ —Å–µ—Ä–≤–µ—Ä—É –ø–æ SSH

### –°–∏–º–ø—Ç–æ–º—ã:
- `Connection timed out`
- `–ü—Ä–µ–≤—ã—à–µ–Ω–æ –≤—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è`
- `Ping –Ω–µ –ø—Ä–æ—Ö–æ–¥–∏—Ç`

### ‚ö†Ô∏è –í–∞—à —Å–µ—Ä–≤–µ—Ä –Ω–∞ Proxmox VE

–ï—Å–ª–∏ –≤–∞—à —Å–µ—Ä–≤–µ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ **Proxmox VE**, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≤–µ–±-–∫–æ–Ω—Å–æ–ª—å:

1. **–û—Ç–∫—Ä–æ–π—Ç–µ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å Proxmox:**
   - –ê–¥—Ä–µ—Å: **https://ru202.vdska.ru:8006**
   - –í–æ–π–¥–∏—Ç–µ —Å —É—á–µ—Ç–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ Proxmox

2. **–ù–∞–π–¥–∏—Ç–µ –≤–∞—à—É –≤–∏—Ä—Ç—É–∞–ª—å–Ω—É—é –º–∞—à–∏–Ω—É:**
   - –í –ª–µ–≤–æ–π –ø–∞–Ω–µ–ª–∏ –Ω–∞–π–¥–∏—Ç–µ –≤–∞—à—É VM
   - –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –æ–Ω–∞ **–∑–∞–ø—É—â–µ–Ω–∞** (—Å—Ç–∞—Ç—É—Å "Running")

3. **–û—Ç–∫—Ä–æ–π—Ç–µ –∫–æ–Ω—Å–æ–ª—å:**
   - –ö–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ VM ‚Üí —Ä–∞–∑–¥–µ–ª **"Console"**
   - –í—ã–±–µ—Ä–∏—Ç–µ **"noVNC"** –∏–ª–∏ **"xterm.js"**
   - –í–æ–π–¥–∏—Ç–µ: `root` / –ø–∞—Ä–æ–ª—å: `Zt7Ncu36feJh`

**–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:** https://ru202.vdska.ru:8006/pve-docs/index.html

### –†–µ—à–µ–Ω–∏—è –¥–ª—è SSH:

#### 1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω—ã
- –í–æ–π–¥–∏—Ç–µ –≤ Proxmox: https://ru202.vdska.ru:8006
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ VM **–≤–∫–ª—é—á–µ–Ω–∞** –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç
- –°—Ç–∞—Ç—É—Å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å "Running"

#### 2. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ SSH —á–µ—Ä–µ–∑ –≤–µ–±-–∫–æ–Ω—Å–æ–ª—å Proxmox
–ï—Å–ª–∏ SSH –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≤–µ–±-–∫–æ–Ω—Å–æ–ª—å –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å SSH
systemctl status ssh

# –ï—Å–ª–∏ –Ω–µ –∑–∞–ø—É—â–µ–Ω, –∑–∞–ø—É—Å—Ç–∏—Ç–µ
systemctl start ssh
systemctl enable ssh

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–∞–π—Ä–≤–æ–ª
ufw status
ufw allow 22/tcp

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ SSH
systemctl restart ssh
```

#### 3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–∞–π—Ä–≤–æ–ª –≤ Proxmox
- –í –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ Proxmox –Ω–∞–π–¥–∏—Ç–µ —Ä–∞–∑–¥–µ–ª "Firewall"
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–æ—Ä—Ç **22 (SSH)** –æ—Ç–∫—Ä—ã—Ç –¥–ª—è –≤–∞—à–µ–π VM
- –ï—Å–ª–∏ –Ω—É–∂–Ω–æ, –¥–æ–±–∞–≤—å—Ç–µ –ø—Ä–∞–≤–∏–ª–æ –¥–ª—è –ø–æ—Ä—Ç–∞ 22

#### 4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–µ—Ç–∏ VM
- –í Proxmox –Ω–∞–π–¥–∏—Ç–µ –≤–∞—à—É VM ‚Üí —Ä–∞–∑–¥–µ–ª "Hardware" ‚Üí "Network"
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Å–µ—Ç–µ–≤–æ–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –Ω–∞—Å—Ç—Ä–æ–µ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ VM –∏–º–µ–µ—Ç –¥–æ—Å—Ç—É–ø –∫ —Å–µ—Ç–∏

#### 5. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≤–µ–±-–∫–æ–Ω—Å–æ–ª—å Proxmox
- –≠—Ç–æ —Å–∞–º—ã–π –Ω–∞–¥–µ–∂–Ω—ã–π —Å–ø–æ—Å–æ–±, –µ—Å–ª–∏ SSH –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
- –ß–µ—Ä–µ–∑ –≤–µ–±-–∫–æ–Ω—Å–æ–ª—å –º–æ–∂–Ω–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –≤—Å–µ –∫–æ–º–∞–Ω–¥—ã —É—Å—Ç–∞–Ω–æ–≤–∫–∏
- –ù–µ —Ç—Ä–µ–±—É–µ—Ç –æ—Ç–∫—Ä—ã—Ç–æ–≥–æ SSH –ø–æ—Ä—Ç–∞

#### 6. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ IP –∞–¥—Ä–µ—Å VM
- –í Proxmox –Ω–∞–π–¥–∏—Ç–µ –≤–∞—à—É VM ‚Üí —Ä–∞–∑–¥–µ–ª "Summary"
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ IP –∞–¥—Ä–µ—Å VM
- –í–æ–∑–º–æ–∂–Ω–æ, IP –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è –æ—Ç `193.32.188.93`

#### 7. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–µ—Ç–∏
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤–∞—à –∏–Ω—Ç–µ—Ä–Ω–µ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç
- –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è —Å –¥—Ä—É–≥–æ–≥–æ –∫–æ–º–ø—å—é—Ç–µ—Ä–∞/—Å–µ—Ç–∏
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç –ª–∏ –≤–∞—à —Ñ–∞–π—Ä–≤–æ–ª/–∞–Ω—Ç–∏–≤–∏—Ä—É—Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ

---

## ‚ùå –ü—Ä–æ–±–ª–µ–º–∞: –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–±–æ—Ä–∫–µ Docker –æ–±—Ä–∞–∑–∞

### –°–∏–º–ø—Ç–æ–º—ã:
- `npm ERR!` –æ—à–∏–±–∫–∏
- `Build failed`
- –û—à–∏–±–∫–∏ –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ `docker-compose build`

### –†–µ—à–µ–Ω–∏—è:

#### 1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
```bash
cd /var/www/derevo
cat .env.production
```
–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—Å–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∑–∞–ø–æ–ª–Ω–µ–Ω—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ.

#### 2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø–Ω–æ–µ –º–µ—Å—Ç–æ –Ω–∞ –¥–∏—Å–∫–µ
```bash
df -h
```
–ï—Å–ª–∏ –¥–∏—Å–∫ –∑–∞–ø–æ–ª–Ω–µ–Ω, –æ—Å–≤–æ–±–æ–¥–∏—Ç–µ –º–µ—Å—Ç–æ:
```bash
docker system prune -a
```

#### 3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ —Å–±–æ—Ä–∫–∏
```bash
docker-compose build --no-cache 2>&1 | tee build.log
cat build.log
```

#### 4. –ü–µ—Ä–µ—Å–æ–±–µ—Ä–∏—Ç–µ –æ–±—Ä–∞–∑
```bash
docker-compose down
docker-compose build --no-cache
docker-compose up -d
```

---

## ‚ùå –ü—Ä–æ–±–ª–µ–º–∞: –°–∞–π—Ç –Ω–µ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è

### –°–∏–º–ø—Ç–æ–º—ã:
- –°–∞–π—Ç –Ω–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è
- –û—à–∏–±–∫–∞ 502 Bad Gateway
- Connection refused

### –†–µ—à–µ–Ω–∏—è:

#### 1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
```bash
cd /var/www/derevo
docker-compose ps
```
–í—Å–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤ —Å—Ç–∞—Ç—É—Å–µ "Up".

#### 2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
```bash
docker-compose logs -f
```
–ò—â–∏—Ç–µ –æ—à–∏–±–∫–∏ –≤ –ª–æ–≥–∞—Ö.

#### 3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–ø—É—â–µ–Ω–æ
```bash
curl http://localhost:3000
```
–î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å—Å—è HTML –∫–æ–¥ —Å—Ç—Ä–∞–Ω–∏—Ü—ã.

#### 4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Nginx
```bash
systemctl status nginx
nginx -t
```

#### 5. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é Nginx
```bash
cat /etc/nginx/sites-available/derevo
```
–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ `proxy_pass` —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ `http://localhost:3000`.

#### 6. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–∏—Å—ã
```bash
docker-compose restart
systemctl restart nginx
```

---

## ‚ùå –ü—Ä–æ–±–ª–µ–º–∞: –û—à–∏–±–∫–∏ –≤ –ª–æ–≥–∞—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

### –°–∏–º–ø—Ç–æ–º—ã:
- `NEXT_PUBLIC_SUPABASE_URL is not defined`
- `SUPABASE_SERVICE_ROLE_KEY is not defined`
- –û—à–∏–±–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Supabase

### –†–µ—à–µ–Ω–∏—è:

#### 1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–∞–π–ª .env.production
```bash
cd /var/www/derevo
cat .env.production
```
–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—Å–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∑–∞–ø–æ–ª–Ω–µ–Ω—ã.

#### 2. –ü–µ—Ä–µ—Å–æ–∑–¥–∞–π—Ç–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
```bash
docker-compose down
docker-compose up -d
```

#### 3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
```bash
docker-compose exec app env | grep SUPABASE
```

---

## ‚ùå –ü—Ä–æ–±–ª–µ–º–∞: Nginx –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è

### –°–∏–º–ø—Ç–æ–º—ã:
- `nginx: [emerg] ...`
- `Failed to start nginx`

### –†–µ—à–µ–Ω–∏—è:

#### 1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
```bash
nginx -t
```

#### 2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, –Ω–µ—Ç –ª–∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ –ø–æ—Ä—Ç–æ–≤
```bash
netstat -tulpn | grep :80
netstat -tulpn | grep :443
```

#### 3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞
```bash
ls -la /etc/nginx/sites-available/derevo
ls -la /etc/nginx/sites-enabled/derevo
```

#### 4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏
```bash
tail -f /var/log/nginx/error.log
```

---

## ‚ùå –ü—Ä–æ–±–ª–µ–º–∞: SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –Ω–µ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è

### –°–∏–º–ø—Ç–æ–º—ã:
- `Failed to obtain certificate`
- Certbot –æ—à–∏–±–∫–∏

### –†–µ—à–µ–Ω–∏—è:

#### 1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –¥–æ–º–µ–Ω —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ —Å–µ—Ä–≤–µ—Ä
```bash
nslookup derevo.space
```
–î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å—Å—è IP `193.32.188.93`.

#### 2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –ø–æ—Ä—Ç 80 –æ—Ç–∫—Ä—ã—Ç
```bash
ufw status
```
–ü–æ—Ä—Ç 80 –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ—Ç–∫—Ä—ã—Ç –¥–ª—è Let's Encrypt.

#### 3. –í—Ä–µ–º–µ–Ω–Ω–æ –æ—Ç–∫–ª—é—á–∏—Ç–µ —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ HTTPS
–í `/etc/nginx/sites-available/derevo` –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ —Ä–µ–¥–∏—Ä–µ–∫—Ç:
```nginx
# return 301 https://$server_name$request_uri;
```

#### 4. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–ª—É—á–∏—Ç—å —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç —Å–Ω–æ–≤–∞
```bash
certbot --nginx -d derevo.space -d www.derevo.space
```

---

## ‚ùå –ü—Ä–æ–±–ª–µ–º–∞: –ú–µ–¥–ª–µ–Ω–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Å–∞–π—Ç–∞

### –†–µ—à–µ–Ω–∏—è:

#### 1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤
```bash
docker stats
htop
```

#### 2. –û–ø—Ç–∏–º–∏–∑–∏—Ä—É–π—Ç–µ Docker
```bash
docker system prune
```

#### 3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –Ω–∞ –æ—à–∏–±–∫–∏
```bash
docker-compose logs | grep -i error
```

---

## üìû –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏

```bash
# –°—Ç–∞—Ç—É—Å –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
systemctl status docker nginx

# –°—Ç–∞—Ç—É—Å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
docker-compose ps

# –õ–æ–≥–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
docker-compose logs -f --tail=100

# –õ–æ–≥–∏ Nginx
tail -f /var/log/nginx/derevo-error.log

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤
docker stats
df -h
free -h

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Ä—Ç–æ–≤
netstat -tulpn | grep -E ':(80|443|3000|22)'

# –ü—Ä–æ–≤–µ—Ä–∫–∞ DNS
nslookup derevo.space
dig derevo.space
```

---

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏

–ü–æ—Å–ª–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –ø—Ä–æ–≤–µ—Ä–∫—É:

```bash
# 1. –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –∑–∞–ø—É—â–µ–Ω—ã
docker-compose ps

# 2. –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –æ—Ç–≤–µ—á–∞–µ—Ç –ª–æ–∫–∞–ª—å–Ω–æ
curl http://localhost:3000

# 3. Nginx —Ä–∞–±–æ—Ç–∞–µ—Ç
systemctl status nginx

# 4. –ü–æ—Ä—Ç—ã –æ—Ç–∫—Ä—ã—Ç—ã
netstat -tulpn | grep -E ':(80|443|3000)'

# 5. –î–æ–º–µ–Ω —Ä–µ–∑–æ–ª–≤–∏—Ç—Å—è
nslookup derevo.space
```

---

–ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ –Ω–µ —Ä–µ—à–µ–Ω–∞, —Å–æ–±–µ—Ä–∏—Ç–µ —Å–ª–µ–¥—É—é—â—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é:

1. –í—ã–≤–æ–¥ `docker-compose logs`
2. –í—ã–≤–æ–¥ `systemctl status nginx`
3. –í—ã–≤–æ–¥ `docker-compose ps`
4. –°–æ–¥–µ—Ä–∂–∏–º–æ–µ `.env.production` (–±–µ–∑ —Ä–µ–∞–ª—å–Ω—ã—Ö –∫–ª—é—á–µ–π!)
5. –í—ã–≤–æ–¥ `nginx -t`


