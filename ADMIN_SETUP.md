# Настройка управления администраторами

Это руководство поможет настроить функционал управления администраторами в админ-панели.

## Что было добавлено

1. **Смена пароля** - вкладка "Пароль" в админ-панели
2. **Управление администраторами** - вкладка "Администраторы" для добавления и удаления администраторов

## Настройка переменных окружения

Для работы управления администраторами необходимо добавить **Service Role Key** из Supabase.

### Шаг 1: Получение Service Role Key

1. Откройте [Supabase Dashboard](https://app.supabase.com)
2. Выберите ваш проект
3. Перейдите в **Settings** → **API**
4. Найдите раздел **Project API keys**
5. Скопируйте **`service_role` key** (⚠️ **НЕ** `anon` key!)

### Шаг 2: Добавление в переменные окружения

#### Локально (`.env.local`)

Добавьте следующую строку:

```env
SUPABASE_SERVICE_ROLE_KEY=your-service-role-key-here
```

**⚠️ ВАЖНО:** 
- Никогда не коммитьте этот ключ в Git!
- Не используйте его на клиенте (в браузере)!
- Этот ключ имеет полный доступ к вашей базе данных

#### На Vercel

1. Откройте проект в Vercel Dashboard
2. Перейдите в **Settings** → **Environment Variables**
3. Добавьте новую переменную:
   - **Name:** `SUPABASE_SERVICE_ROLE_KEY`
   - **Value:** ваш service role key
   - **Environment:** Production, Preview, Development (все)
4. Сохраните и пересоберите проект

## Использование

### Смена пароля

1. Войдите в админ-панель
2. Перейдите на вкладку **"Пароль"**
3. Введите:
   - Текущий пароль
   - Новый пароль (минимум 6 символов)
   - Подтверждение нового пароля
4. Нажмите **"Изменить пароль"**

### Добавление администратора

1. Войдите в админ-панель
2. Перейдите на вкладку **"Администраторы"**
3. Нажмите **"Добавить администратора"**
4. Введите:
   - Email нового администратора
   - Пароль (минимум 6 символов)
5. Нажмите **"Создать"**

Новый администратор сможет сразу войти в админ-панель с указанными email и паролем.

### Удаление администратора

1. Перейдите на вкладку **"Администраторы"**
2. Найдите администратора в списке
3. Нажмите кнопку удаления (иконка корзины)
4. Подтвердите удаление

**⚠️ Внимание:** Удаление администратора необратимо. Убедитесь, что вы не удаляете последнего администратора!

## Безопасность

- **Service Role Key** имеет полный доступ к базе данных
- Храните его только в переменных окружения на сервере
- Никогда не используйте его в клиентском коде
- Регулярно проверяйте список администраторов
- Используйте сильные пароли для администраторов

## Решение проблем

### Ошибка "SUPABASE_SERVICE_ROLE_KEY не настроен"

**Решение:** Убедитесь, что переменная `SUPABASE_SERVICE_ROLE_KEY` добавлена в `.env.local` (локально) или в настройках Vercel (на продакшене).

### Ошибка 401 при создании администратора

**Решение:** 
1. Проверьте, что вы авторизованы в админ-панели
2. Убедитесь, что `SUPABASE_SERVICE_ROLE_KEY` правильный
3. Проверьте логи в консоли браузера и на сервере

### Ошибка при удалении администратора

**Решение:**
1. Убедитесь, что вы не пытаетесь удалить самого себя
2. Проверьте, что `SUPABASE_SERVICE_ROLE_KEY` настроен правильно
3. Проверьте логи на сервере

## Полезные ссылки

- [Supabase Auth Admin API](https://supabase.com/docs/reference/javascript/auth-admin)
- [Next.js Environment Variables](https://nextjs.org/docs/app/building-your-application/configuring/environment-variables)


