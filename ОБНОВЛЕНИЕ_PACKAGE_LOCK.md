# üì¶ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ package-lock.json

## ‚ùå –ü—Ä–æ–±–ª–µ–º–∞: npm ci –Ω–µ –º–æ–∂–µ—Ç –Ω–∞–π—Ç–∏ –ø–∞–∫–µ—Ç—ã

**–û—à–∏–±–∫–∞:**
```
npm error Missing: @img/sharp-linux-x64@1.0.4
npm error Missing: sharp@0.33.0
...
ERROR: Service 'app' failed to build: Build failed
```

**–ü—Ä–∏—á–∏–Ω–∞:** `package-lock.json` –Ω–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω —Å `package.json` –ø–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è `sharp`.

---

## ‚úÖ –†–µ—à–µ–Ω–∏–µ

### –í–∞—Ä–∏–∞–Ω—Ç 1: –û–±–Ω–æ–≤–∏—Ç—å package-lock.json –ª–æ–∫–∞–ª—å–Ω–æ (–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

**–ù–∞ –≤–∞—à–µ–º –∫–æ–º–ø—å—é—Ç–µ—Ä–µ (Windows):**

```powershell
# –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –ø–∞–ø–∫—É –ø—Ä–æ–µ–∫—Ç–∞
cd C:\Users\maks\Desktop\zakaz

# –û–±–Ω–æ–≤–∏—Ç–µ package-lock.json
npm install

# –ó–∞–∫–æ–º–º–∏—Ç—å—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
git add package-lock.json
git commit -m "Update package-lock.json with sharp dependency"
git push origin main
```

**–ó–∞—Ç–µ–º –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ:**

```bash
cd /var/www/derevo
git pull origin main
docker-compose build --no-cache
docker-compose up -d
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å npm install –≤ Dockerfile (–£–∂–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ)

**Dockerfile —É–∂–µ –æ–±–Ω–æ–≤–ª–µ–Ω** - —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `npm install` –≤–º–µ—Å—Ç–æ `npm ci`, —á—Ç–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–∏—Ç lock file –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏.

**–ù–∞ —Å–µ—Ä–≤–µ—Ä–µ:**

```bash
cd /var/www/derevo

# –û–±–Ω–æ–≤–∏—Ç–µ Dockerfile (–µ—Å–ª–∏ –µ—â–µ –Ω–µ –æ–±–Ω–æ–≤–ª–µ–Ω)
git pull origin main

# –ò–ª–∏ –æ–±–Ω–æ–≤–∏—Ç–µ –≤—Ä—É—á–Ω—É—é —á–µ—Ä–µ–∑ –≤–µ–±-–∫–æ–Ω—Å–æ–ª—å:
# –ó–∞–º–µ–Ω–∏—Ç–µ –≤ Dockerfile:
# RUN npm ci
# –ù–∞:
# RUN npm install

# –ü–µ—Ä–µ—Å–æ–±–µ—Ä–∏—Ç–µ –æ–±—Ä–∞–∑
docker-compose build --no-cache

# –ó–∞–ø—É—Å—Ç–∏—Ç–µ
docker-compose up -d

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏
docker-compose logs -f
```

### –í–∞—Ä–∏–∞–Ω—Ç 3: –£–¥–∞–ª–∏—Ç—å package-lock.json –∏ –ø–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å

**–ù–∞ —Å–µ—Ä–≤–µ—Ä–µ (–µ—Å–ª–∏ –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ Git):**

```bash
cd /var/www/derevo

# –£–¥–∞–ª–∏—Ç–µ —Å—Ç–∞—Ä—ã–π lock file
rm -f package-lock.json

# –û–±–Ω–æ–≤–∏—Ç–µ Dockerfile —á—Ç–æ–±—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å npm install
# (—É–∂–µ —Å–¥–µ–ª–∞–Ω–æ, –µ—Å–ª–∏ –æ–±–Ω–æ–≤–∏–ª–∏ –∫–æ–¥)

# –ü–µ—Ä–µ—Å–æ–±–µ—Ä–∏—Ç–µ
docker-compose build --no-cache
docker-compose up -d
```

---

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞

### –ü–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
docker-compose ps

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏
docker-compose logs app | grep -i error

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–±–æ—Ç—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
curl http://localhost:3000
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- –ù–µ—Ç –æ—à–∏–±–æ–∫ –ø—Ä–æ missing packages
- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –∑–∞–ø—É—â–µ–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç
- –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ –∑–∞–ø—Ä–æ—Å—ã

---

## üìã –ß–µ–∫-–ª–∏—Å—Ç

- [ ] –û–±–Ω–æ–≤–ª–µ–Ω `package-lock.json` –ª–æ–∫–∞–ª—å–Ω–æ (`npm install`)
- [ ] –ò–∑–º–µ–Ω–µ–Ω–∏—è –∑–∞–∫–æ–º–º–∏—á–µ–Ω—ã –∏ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã –≤ Git
- [ ] –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ –æ–±–Ω–æ–≤–ª–µ–Ω –∫–æ–¥ (`git pull`)
- [ ] Dockerfile –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `npm install` –≤–º–µ—Å—Ç–æ `npm ci`
- [ ] Docker –æ–±—Ä–∞–∑ –ø–µ—Ä–µ—Å–æ–±—Ä–∞–Ω (`docker-compose build --no-cache`)
- [ ] –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –∑–∞–ø—É—â–µ–Ω—ã (`docker-compose up -d`)
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω—ã –ª–æ–≥–∏ –Ω–∞ –æ—à–∏–±–∫–∏
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω–∞ —Ä–∞–±–æ—Ç–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

---

## ‚úÖ –ì–æ—Ç–æ–≤–æ!

–ü–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è `package-lock.json` –∏ –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∏ Docker –æ–±—Ä–∞–∑–∞, –≤—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –¥–æ–ª–∂–Ω—ã —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.

**–£–¥–∞—á–∏! üöÄ**

