# ðŸ”’ Ð ÐµÑˆÐµÐ½Ð¸Ðµ Ð¿Ñ€Ð¾Ð±Ð»ÐµÐ¼ Ñ SSL ÑÐµÑ€Ñ‚Ð¸Ñ„Ð¸ÐºÐ°Ñ‚Ð¾Ð¼

## âŒ ÐŸÑ€Ð¾Ð±Ð»ÐµÐ¼Ð°: Certbot Ð½Ðµ Ð¼Ð¾Ð¶ÐµÑ‚ Ð¿Ð¾Ð»ÑƒÑ‡Ð¸Ñ‚ÑŒ ÑÐµÑ€Ñ‚Ð¸Ñ„Ð¸ÐºÐ°Ñ‚

**Ð¡Ð¸Ð¼Ð¿Ñ‚Ð¾Ð¼Ñ‹:**
- `Timeout during connect (likely firewall problem)` âš ï¸ **ÐÐžÐ’ÐÐ¯ ÐŸÐ ÐžÐ‘Ð›Ð•ÐœÐ!**
- `404` Ð´Ð»Ñ `derevo.space` Ð¿Ñ€Ð¸ Ð´Ð¾ÑÑ‚ÑƒÐ¿Ðµ Ðº `/.well-known/acme-challenge/`
- `502 Bad Gateway` Ð´Ð»Ñ `www.derevo.space`
- `Some challenges have failed`

**ÐŸÑ€Ð¸Ñ‡Ð¸Ð½Ñ‹:**
1. âš ï¸ **ÐŸÐ¾Ñ€Ñ‚ 80 Ð·Ð°Ð±Ð»Ð¾ÐºÐ¸Ñ€Ð¾Ð²Ð°Ð½ Ñ„Ð°Ð¹Ñ€Ð²Ð¾Ð»Ð¾Ð¼** (ÐµÑÐ»Ð¸ Ð²Ð¸Ð´Ð¸Ñ‚Ðµ "Timeout during connect")
   - Let's Encrypt Ð½Ðµ Ð¼Ð¾Ð¶ÐµÑ‚ Ð¿Ð¾Ð´ÐºÐ»ÑŽÑ‡Ð¸Ñ‚ÑŒÑÑ Ðº ÑÐµÑ€Ð²ÐµÑ€Ñƒ
   - ÐÑƒÐ¶Ð½Ð¾ Ð¾Ñ‚ÐºÑ€Ñ‹Ñ‚ÑŒ Ð¿Ð¾Ñ€Ñ‚Ñ‹ 80 Ð¸ 443 Ð² Ñ„Ð°Ð¹Ñ€Ð²Ð¾Ð»Ðµ
2. âš ï¸ **Ð”Ð¾Ð¼ÐµÐ½Ñ‹ Ð½Ðµ ÑƒÐºÐ°Ð·Ñ‹Ð²Ð°ÑŽÑ‚ Ð½Ð° Ð¿Ñ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ñ‹Ð¹ IP** (ÐµÑÐ»Ð¸ Ð²Ð¸Ð´Ð¸Ñ‚Ðµ `404` Ð¸Ð»Ð¸ `502`)
   - Ð”Ð¾Ð¼ÐµÐ½Ñ‹ ÑƒÐºÐ°Ð·Ñ‹Ð²Ð°ÑŽÑ‚ Ð½Ð° `95.163.244.138` Ð²Ð¼ÐµÑÑ‚Ð¾ `193.32.188.93`
   - ÐÑƒÐ¶Ð½Ð¾ Ð¾Ð±Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ DNS Ð·Ð°Ð¿Ð¸ÑÐ¸ Ñƒ Ñ€ÐµÐ³Ð¸ÑÑ‚Ñ€Ð°Ñ‚Ð¾Ñ€Ð° Ð´Ð¾Ð¼ÐµÐ½Ð°
3. ÐŸÑ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ Ð½Ðµ Ð·Ð°Ð¿ÑƒÑ‰ÐµÐ½Ð¾ (502 Bad Gateway)
4. Nginx Ð½Ðµ Ð½Ð°ÑÑ‚Ñ€Ð¾ÐµÐ½ Ð´Ð»Ñ Ñ€Ð°Ð±Ð¾Ñ‚Ñ‹ Ñ Certbot

---

## âœ… Ð ÐµÑˆÐµÐ½Ð¸Ðµ: ÐŸÐ¾ÑˆÐ°Ð³Ð¾Ð²Ð°Ñ Ð¸Ð½ÑÑ‚Ñ€ÑƒÐºÑ†Ð¸Ñ

### âš ï¸ Ð¨ÐÐ“ 0: Ð•ÑÐ»Ð¸ Ð²Ð¸Ð´Ð¸Ñ‚Ðµ "Timeout during connect" - Ð¾Ñ‚ÐºÑ€Ð¾Ð¹Ñ‚Ðµ Ð¿Ð¾Ñ€Ñ‚Ñ‹ Ð² Ñ„Ð°Ð¹Ñ€Ð²Ð¾Ð»Ðµ!

**Ð­Ñ‚Ð¾ ÑÐ°Ð¼Ð°Ñ Ñ‡Ð°ÑÑ‚Ð°Ñ Ð¿Ñ€Ð¾Ð±Ð»ÐµÐ¼Ð° Ð¿Ð¾ÑÐ»Ðµ Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ñ DNS!**

#### Ð ÐµÑˆÐµÐ½Ð¸Ðµ 1: ÐžÑ‚ÐºÑ€Ð¾Ð¹Ñ‚Ðµ Ð¿Ð¾Ñ€Ñ‚Ñ‹ Ñ‡ÐµÑ€ÐµÐ· UFW (ÐµÑÐ»Ð¸ ÑƒÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½)

```bash
# ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ ÑÑ‚Ð°Ñ‚ÑƒÑ Ñ„Ð°Ð¹Ñ€Ð²Ð¾Ð»Ð°
ufw status

# ÐžÑ‚ÐºÑ€Ð¾Ð¹Ñ‚Ðµ Ð¿Ð¾Ñ€Ñ‚ 80 (HTTP)
ufw allow 80/tcp

# ÐžÑ‚ÐºÑ€Ð¾Ð¹Ñ‚Ðµ Ð¿Ð¾Ñ€Ñ‚ 443 (HTTPS)
ufw allow 443/tcp

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ ÑÑ‚Ð°Ñ‚ÑƒÑ ÑÐ½Ð¾Ð²Ð°
ufw status
```

**ÐžÐ¶Ð¸Ð´Ð°ÐµÐ¼Ñ‹Ð¹ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚:** Ð”Ð¾Ð»Ð¶Ð½Ñ‹ ÑƒÐ²Ð¸Ð´ÐµÑ‚ÑŒ:
```
80/tcp                     ALLOW       Anywhere
443/tcp                    ALLOW       Anywhere
```

#### Ð ÐµÑˆÐµÐ½Ð¸Ðµ 2: ÐžÑ‚ÐºÑ€Ð¾Ð¹Ñ‚Ðµ Ð¿Ð¾Ñ€Ñ‚Ñ‹ Ñ‡ÐµÑ€ÐµÐ· iptables

```bash
# ÐžÑ‚ÐºÑ€Ð¾Ð¹Ñ‚Ðµ Ð¿Ð¾Ñ€Ñ‚ 80
iptables -A INPUT -p tcp --dport 80 -j ACCEPT
iptables -A INPUT -p tcp --dport 443 -j ACCEPT

# Ð¡Ð¾Ñ…Ñ€Ð°Ð½Ð¸Ñ‚Ðµ Ð¿Ñ€Ð°Ð²Ð¸Ð»Ð° (Ð´Ð»Ñ Debian/Ubuntu)
iptables-save > /etc/iptables/rules.v4

# Ð˜Ð»Ð¸ Ð´Ð»Ñ ÑÐ¸ÑÑ‚ÐµÐ¼ Ð±ÐµÐ· iptables-persistent
apt-get install iptables-persistent -y
netfilter-persistent save
```

#### Ð ÐµÑˆÐµÐ½Ð¸Ðµ 3: ÐžÑ‚ÐºÑ€Ð¾Ð¹Ñ‚Ðµ Ð¿Ð¾Ñ€Ñ‚Ñ‹ Ñ‡ÐµÑ€ÐµÐ· Ð¿Ð°Ð½ÐµÐ»ÑŒ ÑƒÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ñ VDSKA âš ï¸ Ð’ÐÐ–ÐÐž!

**VDSKA Ð¼Ð¾Ð¶ÐµÑ‚ Ð±Ð»Ð¾ÐºÐ¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Ð¿Ð¾Ñ€Ñ‚Ñ‹ Ð½Ð° ÑƒÑ€Ð¾Ð²Ð½Ðµ Ð¿Ñ€Ð¾Ð²Ð°Ð¹Ð´ÐµÑ€Ð°!**

1. **Ð’Ð¾Ð¹Ð´Ð¸Ñ‚Ðµ Ð² Ð¿Ð°Ð½ÐµÐ»ÑŒ ÑƒÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ñ VDSKA:**
   - URL: https://ru202.vdska.ru:8006 (Proxmox)
   - Ð˜Ð»Ð¸ Ð¿Ð°Ð½ÐµÐ»ÑŒ ÑƒÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ñ VDSKA (ÐµÑÐ»Ð¸ ÐµÑÑ‚ÑŒ Ð¾Ñ‚Ð´ÐµÐ»ÑŒÐ½Ð°Ñ)

2. **ÐÐ°Ð¹Ð´Ð¸Ñ‚Ðµ Ñ€Ð°Ð·Ð´ÐµÐ» "Firewall" Ð¸Ð»Ð¸ "Ð¤Ð°Ð¹Ñ€Ð²Ð¾Ð»"**

3. **ÐžÑ‚ÐºÑ€Ð¾Ð¹Ñ‚Ðµ Ð¿Ð¾Ñ€Ñ‚Ñ‹:**
   - ÐŸÐ¾Ñ€Ñ‚ `80` (TCP) - Ð´Ð»Ñ HTTP
   - ÐŸÐ¾Ñ€Ñ‚ `443` (TCP) - Ð´Ð»Ñ HTTPS

4. **Ð¡Ð¾Ñ…Ñ€Ð°Ð½Ð¸Ñ‚Ðµ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ñ**

#### Ð ÐµÑˆÐµÐ½Ð¸Ðµ 4: ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ Ñ„Ð°Ð¹Ñ€Ð²Ð¾Ð» Proxmox

Ð•ÑÐ»Ð¸ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÑ‚Ðµ Proxmox VE:

```bash
# ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ Ð¿Ñ€Ð°Ð²Ð¸Ð»Ð° Ñ„Ð°Ð¹Ñ€Ð²Ð¾Ð»Ð° Proxmox
pve-firewall status

# Ð˜Ð»Ð¸ Ñ‡ÐµÑ€ÐµÐ· Ð²ÐµÐ±-Ð¸Ð½Ñ‚ÐµÑ€Ñ„ÐµÐ¹Ñ:
# Datacenter â†’ Firewall â†’ Options
```

#### ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ð¾ÑÑ‚Ð¸ Ð¿Ð¾Ñ€Ñ‚Ð¾Ð²:

```bash
# ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ, Ñ‡Ñ‚Ð¾ Ð¿Ð¾Ñ€Ñ‚ 80 ÑÐ»ÑƒÑˆÐ°ÐµÑ‚ÑÑ
netstat -tlnp | grep :80
# Ð˜Ð»Ð¸
ss -tlnp | grep :80

# Ð”Ð¾Ð»Ð¶Ð½Ð¾ Ð¿Ð¾ÐºÐ°Ð·Ð°Ñ‚ÑŒ Ñ‡Ñ‚Ð¾-Ñ‚Ð¾ Ð²Ñ€Ð¾Ð´Ðµ:
# tcp  0  0 0.0.0.0:80  0.0.0.0:*  LISTEN  nginx

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ð¾ÑÑ‚ÑŒ Ñ Ð²Ð½ÐµÑˆÐ½ÐµÐ³Ð¾ IP (Ñ Ð´Ñ€ÑƒÐ³Ð¾Ð³Ð¾ ÑÐµÑ€Ð²ÐµÑ€Ð° Ð¸Ð»Ð¸ Ð¾Ð½Ð»Ð°Ð¹Ð½-ÑÐµÑ€Ð²Ð¸ÑÐ°)
# Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐ¹Ñ‚Ðµ: https://www.yougetsignal.com/tools/open-ports/
# Ð˜Ð»Ð¸ Ñ Ð´Ñ€ÑƒÐ³Ð¾Ð³Ð¾ ÑÐµÑ€Ð²ÐµÑ€Ð°:
# curl -I http://193.32.188.93
```

**ÐŸÐ¾ÑÐ»Ðµ Ð¾Ñ‚ÐºÑ€Ñ‹Ñ‚Ð¸Ñ Ð¿Ð¾Ñ€Ñ‚Ð¾Ð² Ð¿Ð¾Ð¿Ñ€Ð¾Ð±ÑƒÐ¹Ñ‚Ðµ Ð¿Ð¾Ð»ÑƒÑ‡Ð¸Ñ‚ÑŒ ÑÐµÑ€Ñ‚Ð¸Ñ„Ð¸ÐºÐ°Ñ‚ ÑÐ½Ð¾Ð²Ð°:**
```bash
certbot --nginx -d derevo.space -d www.derevo.space
```

---

### Ð¨Ð°Ð³ 1: ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ, Ñ‡Ñ‚Ð¾ Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ Ð·Ð°Ð¿ÑƒÑ‰ÐµÐ½Ð¾

```bash
cd /var/www/derevo
docker-compose ps
```

**ÐžÐ¶Ð¸Ð´Ð°ÐµÐ¼Ñ‹Ð¹ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚:** ÐšÐ¾Ð½Ñ‚ÐµÐ¹Ð½ÐµÑ€ Ð´Ð¾Ð»Ð¶ÐµÐ½ Ð±Ñ‹Ñ‚ÑŒ Ð² ÑÑ‚Ð°Ñ‚ÑƒÑÐµ `Up`

**Ð•ÑÐ»Ð¸ ÐºÐ¾Ð½Ñ‚ÐµÐ¹Ð½ÐµÑ€ Ð½Ðµ Ð·Ð°Ð¿ÑƒÑ‰ÐµÐ½:**

```bash
# Ð—Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚Ðµ ÐºÐ¾Ð½Ñ‚ÐµÐ¹Ð½ÐµÑ€
docker-compose up -d

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ Ð»Ð¾Ð³Ð¸
docker-compose logs -f
```

**ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ, Ñ‡Ñ‚Ð¾ Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ Ð¾Ñ‚Ð²ÐµÑ‡Ð°ÐµÑ‚:**

```bash
curl http://localhost:3000
```

**ÐžÐ¶Ð¸Ð´Ð°ÐµÐ¼Ñ‹Ð¹ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚:** Ð”Ð¾Ð»Ð¶ÐµÐ½ Ð²ÐµÑ€Ð½ÑƒÑ‚ÑŒÑÑ HTML ÐºÐ¾Ð´ ÑÑ‚Ñ€Ð°Ð½Ð¸Ñ†Ñ‹

**Ð•ÑÐ»Ð¸ Ð½Ðµ Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚:**
- ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ Ð»Ð¾Ð³Ð¸: `docker-compose logs`
- ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ Ñ„Ð°Ð¹Ð» `.env.production`: `cat .env.production`
- Ð£Ð±ÐµÐ´Ð¸Ñ‚ÐµÑÑŒ, Ñ‡Ñ‚Ð¾ Ð²ÑÐµ Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ðµ Ð·Ð°Ð¿Ð¾Ð»Ð½ÐµÐ½Ñ‹

---

### Ð¨Ð°Ð³ 2: ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸ÑŽ Nginx

```bash
# ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ ÑÐ¸Ð½Ñ‚Ð°ÐºÑÐ¸Ñ
nginx -t
```

**Ð”Ð¾Ð»Ð¶Ð½Ð¾ Ð±Ñ‹Ñ‚ÑŒ:** `syntax is ok` Ð¸ `test is successful`

**ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸ÑŽ:**

```bash
cat /etc/nginx/sites-available/derevo
```

**Ð£Ð±ÐµÐ´Ð¸Ñ‚ÐµÑÑŒ, Ñ‡Ñ‚Ð¾:**
- `proxy_pass http://localhost:3000;` ÑƒÐºÐ°Ð·Ð°Ð½ Ð¿Ñ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ð¾
- ÐÐµÑ‚ Ñ€ÐµÐ´Ð¸Ñ€ÐµÐºÑ‚Ð° Ð½Ð° HTTPS (Ð´Ð¾Ð»Ð¶ÐµÐ½ Ð±Ñ‹Ñ‚ÑŒ Ð·Ð°ÐºÐ¾Ð¼Ð¼ÐµÐ½Ñ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½)

**ÐŸÐµÑ€ÐµÐ·Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚Ðµ Nginx:**

```bash
systemctl restart nginx
systemctl status nginx
```

---

### Ð¨Ð°Ð³ 3: ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ, Ñ‡Ñ‚Ð¾ Ð´Ð¾Ð¼ÐµÐ½Ñ‹ ÑƒÐºÐ°Ð·Ñ‹Ð²Ð°ÑŽÑ‚ Ð½Ð° Ð¿Ñ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ñ‹Ð¹ IP âš ï¸ Ð’ÐÐ–ÐÐž!

```bash
nslookup derevo.space
nslookup www.derevo.space
```

**ÐžÐ¶Ð¸Ð´Ð°ÐµÐ¼Ñ‹Ð¹ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚:** ÐžÐ±Ð° Ð´Ð¾Ð»Ð¶Ð½Ñ‹ Ð²ÐµÑ€Ð½ÑƒÑ‚ÑŒ IP `193.32.188.93`

**âŒ Ð•ÑÐ»Ð¸ IP Ð´Ñ€ÑƒÐ³Ð¾Ð¹ (Ð½Ð°Ð¿Ñ€Ð¸Ð¼ÐµÑ€, `95.163.244.138`):**

**Ð­Ñ‚Ð¾ Ð¾ÑÐ½Ð¾Ð²Ð½Ð°Ñ Ð¿Ñ€Ð¸Ñ‡Ð¸Ð½Ð° Ð¿Ñ€Ð¾Ð±Ð»ÐµÐ¼Ñ‹!** Ð”Ð¾Ð¼ÐµÐ½Ñ‹ Ð½Ðµ ÑƒÐºÐ°Ð·Ñ‹Ð²Ð°ÑŽÑ‚ Ð½Ð° Ð²Ð°Ñˆ ÑÐµÑ€Ð²ÐµÑ€.

**Ð ÐµÑˆÐµÐ½Ð¸Ðµ:**

1. **Ð’Ð¾Ð¹Ð´Ð¸Ñ‚Ðµ Ð² Ð¿Ð°Ð½ÐµÐ»ÑŒ ÑƒÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ñ Ð²Ð°ÑˆÐµÐ³Ð¾ Ñ€ÐµÐ³Ð¸ÑÑ‚Ñ€Ð°Ñ‚Ð¾Ñ€Ð° Ð´Ð¾Ð¼ÐµÐ½Ð°** (Ð³Ð´Ðµ Ð²Ñ‹ Ð¿Ð¾ÐºÑƒÐ¿Ð°Ð»Ð¸ Ð´Ð¾Ð¼ÐµÐ½ `derevo.space`)

2. **ÐÐ°Ð¹Ð´Ð¸Ñ‚Ðµ Ñ€Ð°Ð·Ð´ÐµÐ» "DNS" Ð¸Ð»Ð¸ "Ð£Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ DNS"**

3. **ÐžÐ±Ð½Ð¾Ð²Ð¸Ñ‚Ðµ A Ð·Ð°Ð¿Ð¸ÑÐ¸:**
   - ÐÐ°Ð¹Ð´Ð¸Ñ‚Ðµ A Ð·Ð°Ð¿Ð¸ÑÑŒ Ð´Ð»Ñ `derevo.space` (Ð¸Ð»Ð¸ `@`)
   - Ð˜Ð·Ð¼ÐµÐ½Ð¸Ñ‚Ðµ IP Ð°Ð´Ñ€ÐµÑ Ð½Ð°: `193.32.188.93`
   - ÐÐ°Ð¹Ð´Ð¸Ñ‚Ðµ A Ð·Ð°Ð¿Ð¸ÑÑŒ Ð´Ð»Ñ `www.derevo.space` (Ð¸Ð»Ð¸ `www`)
   - Ð˜Ð·Ð¼ÐµÐ½Ð¸Ñ‚Ðµ IP Ð°Ð´Ñ€ÐµÑ Ð½Ð°: `193.32.188.93`
   - Ð˜Ð»Ð¸ ÑÐ¾Ð·Ð´Ð°Ð¹Ñ‚Ðµ CNAME Ð·Ð°Ð¿Ð¸ÑÑŒ: `www` â†’ `derevo.space`

4. **Ð¡Ð¾Ñ…Ñ€Ð°Ð½Ð¸Ñ‚Ðµ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ñ**

5. **ÐŸÐ¾Ð´Ð¾Ð¶Ð´Ð¸Ñ‚Ðµ Ñ€Ð°ÑÐ¿Ñ€Ð¾ÑÑ‚Ñ€Ð°Ð½ÐµÐ½Ð¸Ñ DNS:**
   - ÐžÐ±Ñ‹Ñ‡Ð½Ð¾ 5-15 Ð¼Ð¸Ð½ÑƒÑ‚
   - Ð˜Ð½Ð¾Ð³Ð´Ð° Ð´Ð¾ 24 Ñ‡Ð°ÑÐ¾Ð² (Ð½Ð¾ Ð¾Ð±Ñ‹Ñ‡Ð½Ð¾ Ð±Ñ‹ÑÑ‚Ñ€ÐµÐµ)

6. **ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ ÑÐ½Ð¾Ð²Ð°:**
   ```bash
   nslookup derevo.space
   nslookup www.derevo.space
   ```
   
   **Ð”Ð¾Ð»Ð¶Ð½Ñ‹ Ð²ÐµÑ€Ð½ÑƒÑ‚ÑŒÑÑ IP `193.32.188.93`**

7. **ÐŸÐ¾ÑÐ»Ðµ Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ñ DNS Ð¿Ð¾Ð¿Ñ€Ð¾Ð±ÑƒÐ¹Ñ‚Ðµ Ð¿Ð¾Ð»ÑƒÑ‡Ð¸Ñ‚ÑŒ ÑÐµÑ€Ñ‚Ð¸Ñ„Ð¸ÐºÐ°Ñ‚ ÑÐ½Ð¾Ð²Ð°:**
   ```bash
   certbot --nginx -d derevo.space -d www.derevo.space
   ```

**âš ï¸ Ð’ÐÐ–ÐÐž:** Ð‘ÐµÐ· Ð¿Ñ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ñ‹Ñ… DNS Ð·Ð°Ð¿Ð¸ÑÐµÐ¹ Certbot Ð½Ðµ ÑÐ¼Ð¾Ð¶ÐµÑ‚ Ð¿Ð¾Ð»ÑƒÑ‡Ð¸Ñ‚ÑŒ ÑÐµÑ€Ñ‚Ð¸Ñ„Ð¸ÐºÐ°Ñ‚!

---

### Ð¨Ð°Ð³ 4: ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ð¾ÑÑ‚ÑŒ ÑÐ°Ð¹Ñ‚Ð°

```bash
# ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ Ð»Ð¾ÐºÐ°Ð»ÑŒÐ½Ð¾
curl -I http://localhost
```

**ÐžÐ¶Ð¸Ð´Ð°ÐµÐ¼Ñ‹Ð¹ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚:** Ð”Ð¾Ð»Ð¶ÐµÐ½ Ð²ÐµÑ€Ð½ÑƒÑ‚ÑŒÑÑ HTTP Ð·Ð°Ð³Ð¾Ð»Ð¾Ð²Ð¾Ðº

**ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ Ñ Ð²Ð½ÐµÑˆÐ½ÐµÐ³Ð¾ IP:**

```bash
curl -I http://193.32.188.93
```

**Ð•ÑÐ»Ð¸ Ð½Ðµ Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚:**
- ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ Ñ„Ð°Ð¹Ñ€Ð²Ð¾Ð»: `ufw status`
- ÐžÑ‚ÐºÑ€Ð¾Ð¹Ñ‚Ðµ Ð¿Ð¾Ñ€Ñ‚ 80: `ufw allow 80/tcp`

---

### Ð¨Ð°Ð³ 5: ÐžÐ±Ð½Ð¾Ð²Ð¸Ñ‚Ðµ ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸ÑŽ Nginx Ð´Ð»Ñ Certbot

**Ð’Ð°Ð¶Ð½Ð¾:** Certbot Ð´Ð¾Ð»Ð¶ÐµÐ½ Ð¸Ð¼ÐµÑ‚ÑŒ Ð´Ð¾ÑÑ‚ÑƒÐ¿ Ðº `/.well-known/acme-challenge/` Ð±ÐµÐ· Ð¿Ñ€Ð¾ÐºÑÐ¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ñ.

**ÐžÐ±Ð½Ð¾Ð²Ð¸Ñ‚Ðµ `/etc/nginx/sites-available/derevo`:**

```bash
nano /etc/nginx/sites-available/derevo
```

**Ð˜Ð»Ð¸ ÑÐ¾Ð·Ð´Ð°Ð¹Ñ‚Ðµ Ñ‡ÐµÑ€ÐµÐ· cat:**

```bash
cat > /etc/nginx/sites-available/derevo << 'EOF'
server {
    listen 80;
    server_name derevo.space www.derevo.space;

    # Ð Ð°Ð·Ñ€ÐµÑˆÐ°ÐµÐ¼ Ð´Ð¾ÑÑ‚ÑƒÐ¿ Ðº acme-challenge Ð´Ð»Ñ Certbot
    location /.well-known/acme-challenge/ {
        root /var/www/certbot;
        try_files $uri =404;
    }

    # Ð’Ñ€ÐµÐ¼ÐµÐ½Ð½Ð¾ Ð¾ÑÑ‚Ð°Ð²Ð»ÑÐµÐ¼ HTTP Ð´Ð»Ñ Ð¿ÐµÑ€Ð²Ð¾Ð½Ð°Ñ‡Ð°Ð»ÑŒÐ½Ð¾Ð¹ Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸
    location / {
        proxy_pass http://localhost:3000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_cache_bypass $http_upgrade;
        
        # Ð¢Ð°Ð¹Ð¼Ð°ÑƒÑ‚Ñ‹
        proxy_connect_timeout 60s;
        proxy_send_timeout 60s;
        proxy_read_timeout 60s;
    }

    # Ð¡Ñ‚Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸Ðµ Ñ„Ð°Ð¹Ð»Ñ‹
    location /_next/static {
        proxy_pass http://localhost:3000;
        proxy_cache_valid 200 60m;
        add_header Cache-Control "public, immutable";
    }

    # Ð›Ð¾Ð³Ð¸
    access_log /var/log/nginx/derevo-access.log;
    error_log /var/log/nginx/derevo-error.log;
}
EOF
```

**Ð¡Ð¾Ð·Ð´Ð°Ð¹Ñ‚Ðµ Ð´Ð¸Ñ€ÐµÐºÑ‚Ð¾Ñ€Ð¸ÑŽ Ð´Ð»Ñ Certbot:**

```bash
mkdir -p /var/www/certbot
chmod 755 /var/www/certbot
```

**ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸ÑŽ:**

```bash
nginx -t
```

**ÐŸÐµÑ€ÐµÐ·Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚Ðµ Nginx:**

```bash
systemctl restart nginx
```

---

### Ð¨Ð°Ð³ 6: ÐŸÐ¾Ð¿Ñ€Ð¾Ð±ÑƒÐ¹Ñ‚Ðµ Ð¿Ð¾Ð»ÑƒÑ‡Ð¸Ñ‚ÑŒ ÑÐµÑ€Ñ‚Ð¸Ñ„Ð¸ÐºÐ°Ñ‚ ÑÐ½Ð¾Ð²Ð°

```bash
certbot --nginx -d derevo.space -d www.derevo.space
```

**Ð¡Ð»ÐµÐ´ÑƒÐ¹Ñ‚Ðµ Ð¸Ð½ÑÑ‚Ñ€ÑƒÐºÑ†Ð¸ÑÐ¼:**
1. Ð’Ð²ÐµÐ´Ð¸Ñ‚Ðµ email
2. Ð¡Ð¾Ð³Ð»Ð°ÑÐ¸Ñ‚ÐµÑÑŒ Ñ ÑƒÑÐ»Ð¾Ð²Ð¸ÑÐ¼Ð¸ (`Y`)
3. Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ Ñ€ÐµÐ´Ð¸Ñ€ÐµÐºÑ‚ Ð½Ð° HTTPS (`2`)

**ÐžÐ¶Ð¸Ð´Ð°ÐµÐ¼Ñ‹Ð¹ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚:** `Congratulations! Your certificate and chain have been saved...`

---

## ðŸ” Ð”Ð¸Ð°Ð³Ð½Ð¾ÑÑ‚Ð¸ÐºÐ°

### ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ñ:

```bash
# Ð¡Ñ‚Ð°Ñ‚ÑƒÑ ÐºÐ¾Ð½Ñ‚ÐµÐ¹Ð½ÐµÑ€Ð¾Ð²
docker-compose ps

# Ð›Ð¾Ð³Ð¸ Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ñ
docker-compose logs -f

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ñ€Ð°Ð±Ð¾Ñ‚Ñ‹
curl http://localhost:3000
```

### ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Nginx:

```bash
# Ð¡Ñ‚Ð°Ñ‚ÑƒÑ Nginx
systemctl status nginx

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ð¸
nginx -t

# Ð›Ð¾Ð³Ð¸ Nginx
tail -f /var/log/nginx/derevo-error.log
```

### ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° DNS:

```bash
# ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° DNS
nslookup derevo.space
nslookup www.derevo.space

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ñ Ð²Ð½ÐµÑˆÐ½ÐµÐ³Ð¾ IP
curl -I http://193.32.188.93
```

### ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ñ„Ð°Ð¹Ñ€Ð²Ð¾Ð»Ð°:

```bash
# Ð¡Ñ‚Ð°Ñ‚ÑƒÑ Ñ„Ð°Ð¹Ñ€Ð²Ð¾Ð»Ð° UFW
ufw status

# ÐžÑ‚ÐºÑ€Ñ‹Ñ‚ÑŒ Ð¿Ð¾Ñ€Ñ‚ 80
ufw allow 80/tcp

# ÐžÑ‚ÐºÑ€Ñ‹Ñ‚ÑŒ Ð¿Ð¾Ñ€Ñ‚ 443
ufw allow 443/tcp

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° iptables
iptables -L -n | grep -E '80|443'

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ°, Ñ‡Ñ‚Ð¾ Ð¿Ð¾Ñ€Ñ‚Ñ‹ ÑÐ»ÑƒÑˆÐ°ÑŽÑ‚ÑÑ
netstat -tlnp | grep -E ':80|:443'
# Ð˜Ð»Ð¸
ss -tlnp | grep -E ':80|:443'

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ð¾ÑÑ‚Ð¸ Ð¿Ð¾Ñ€Ñ‚Ð¾Ð² Ñ Ð²Ð½ÐµÑˆÐ½ÐµÐ³Ð¾ IP
# Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐ¹Ñ‚Ðµ Ð¾Ð½Ð»Ð°Ð¹Ð½-ÑÐµÑ€Ð²Ð¸Ñ: https://www.yougetsignal.com/tools/open-ports/
# Ð’Ð²ÐµÐ´Ð¸Ñ‚Ðµ IP: 193.32.188.93
# ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ Ð¿Ð¾Ñ€Ñ‚Ñ‹: 80 Ð¸ 443
```

**âš ï¸ Ð’ÐÐ–ÐÐž:** Ð•ÑÐ»Ð¸ Ð¿Ð¾Ñ€Ñ‚Ñ‹ Ð·Ð°ÐºÑ€Ñ‹Ñ‚Ñ‹ Ð² Ð¿Ð°Ð½ÐµÐ»Ð¸ VDSKA, Ð¾Ñ‚ÐºÑ€Ð¾Ð¹Ñ‚Ðµ Ð¸Ñ… Ñ‚Ð°Ð¼!

---

## â— ÐÐ»ÑŒÑ‚ÐµÑ€Ð½Ð°Ñ‚Ð¸Ð²Ð½Ñ‹Ðµ Ñ€ÐµÑˆÐµÐ½Ð¸Ñ

### Ð ÐµÑˆÐµÐ½Ð¸Ðµ 1: Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÑŒ standalone Ñ€ÐµÐ¶Ð¸Ð¼ Certbot

Ð•ÑÐ»Ð¸ Nginx Ð½Ðµ Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚, Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐ¹Ñ‚Ðµ standalone Ñ€ÐµÐ¶Ð¸Ð¼:

```bash
# ÐžÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚Ðµ Nginx Ð²Ñ€ÐµÐ¼ÐµÐ½Ð½Ð¾
systemctl stop nginx

# ÐŸÐ¾Ð»ÑƒÑ‡Ð¸Ñ‚Ðµ ÑÐµÑ€Ñ‚Ð¸Ñ„Ð¸ÐºÐ°Ñ‚ Ð² standalone Ñ€ÐµÐ¶Ð¸Ð¼Ðµ
certbot certonly --standalone -d derevo.space -d www.derevo.space

# Ð—Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚Ðµ Nginx Ð¾Ð±Ñ€Ð°Ñ‚Ð½Ð¾
systemctl start nginx
```

**Ð—Ð°Ñ‚ÐµÐ¼ Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¹Ñ‚Ðµ Nginx Ð²Ñ€ÑƒÑ‡Ð½ÑƒÑŽ** Ñ Ð¿Ð¾Ð»ÑƒÑ‡ÐµÐ½Ð½Ñ‹Ð¼Ð¸ ÑÐµÑ€Ñ‚Ð¸Ñ„Ð¸ÐºÐ°Ñ‚Ð°Ð¼Ð¸.

### Ð ÐµÑˆÐµÐ½Ð¸Ðµ 2: Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÑŒ DNS-Ð²Ð°Ð»Ð¸Ð´Ð°Ñ†Ð¸ÑŽ

Ð•ÑÐ»Ð¸ HTTP-Ð²Ð°Ð»Ð¸Ð´Ð°Ñ†Ð¸Ñ Ð½Ðµ Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚, Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐ¹Ñ‚Ðµ DNS:

```bash
certbot certonly --manual --preferred-challenges dns -d derevo.space -d www.derevo.space
```

Ð¡Ð»ÐµÐ´ÑƒÐ¹Ñ‚Ðµ Ð¸Ð½ÑÑ‚Ñ€ÑƒÐºÑ†Ð¸ÑÐ¼ Ð½Ð° ÑÐºÑ€Ð°Ð½Ðµ - Ð½ÑƒÐ¶Ð½Ð¾ Ð±ÑƒÐ´ÐµÑ‚ Ð´Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ TXT Ð·Ð°Ð¿Ð¸ÑÑŒ Ð² DNS.

---

## âœ… ÐŸÐ¾ÑÐ»Ðµ ÑƒÑÐ¿ÐµÑˆÐ½Ð¾Ð³Ð¾ Ð¿Ð¾Ð»ÑƒÑ‡ÐµÐ½Ð¸Ñ ÑÐµÑ€Ñ‚Ð¸Ñ„Ð¸ÐºÐ°Ñ‚Ð°

### ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¾Ðµ Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ:

```bash
certbot renew --dry-run
```

**ÐžÐ¶Ð¸Ð´Ð°ÐµÐ¼Ñ‹Ð¹ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚:** `The dry run was successful.`

### ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ Ñ€Ð°Ð±Ð¾Ñ‚Ñƒ ÑÐ°Ð¹Ñ‚Ð°:

```bash
# ÐžÑ‚ÐºÑ€Ð¾Ð¹Ñ‚Ðµ Ð² Ð±Ñ€Ð°ÑƒÐ·ÐµÑ€Ðµ
https://derevo.space
https://www.derevo.space
```

**Ð¡Ð°Ð¹Ñ‚ Ð´Ð¾Ð»Ð¶ÐµÐ½ Ð¾Ñ‚ÐºÑ€Ñ‹Ð²Ð°Ñ‚ÑŒÑÑ Ð¿Ð¾ HTTPS!** ðŸŽ‰

---

## ðŸ“ž Ð•ÑÐ»Ð¸ Ð½Ð¸Ñ‡ÐµÐ³Ð¾ Ð½Ðµ Ð¿Ð¾Ð¼Ð¾Ð³Ð°ÐµÑ‚

1. **ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ Ð»Ð¾Ð³Ð¸ Certbot:**
   ```bash
   cat /var/log/letsencrypt/letsencrypt.log
   ```

2. **ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ Ð»Ð¾Ð³Ð¸ Nginx:**
   ```bash
   tail -f /var/log/nginx/derevo-error.log
   ```

3. **Ð£Ð±ÐµÐ´Ð¸Ñ‚ÐµÑÑŒ, Ñ‡Ñ‚Ð¾:**
   - ÐŸÑ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ Ð·Ð°Ð¿ÑƒÑ‰ÐµÐ½Ð¾ Ð¸ Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚
   - Nginx Ð·Ð°Ð¿ÑƒÑ‰ÐµÐ½ Ð¸ Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚
   - Ð”Ð¾Ð¼ÐµÐ½Ñ‹ ÑƒÐºÐ°Ð·Ñ‹Ð²Ð°ÑŽÑ‚ Ð½Ð° Ð¿Ñ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ñ‹Ð¹ IP
   - ÐŸÐ¾Ñ€Ñ‚ 80 Ð¾Ñ‚ÐºÑ€Ñ‹Ñ‚ Ð² Ñ„Ð°Ð¹Ñ€Ð²Ð¾Ð»Ðµ

4. **ÐžÐ±Ñ€Ð°Ñ‚Ð¸Ñ‚ÐµÑÑŒ Ðº Ð¿Ñ€Ð¾Ð²Ð°Ð¹Ð´ÐµÑ€Ñƒ:**
   - Ð¡Ð¾Ð¾Ð±Ñ‰Ð¸Ñ‚Ðµ Ð¾ Ð¿Ñ€Ð¾Ð±Ð»ÐµÐ¼Ð°Ñ… Ñ SSL
   - ÐŸÐ¾Ð¿Ñ€Ð¾ÑÐ¸Ñ‚Ðµ Ð¿Ñ€Ð¾Ð²ÐµÑ€Ð¸Ñ‚ÑŒ Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸ ÑÐµÑ‚Ð¸

---

## âœ… Ð“Ð¾Ñ‚Ð¾Ð²Ð¾!

ÐŸÐ¾ÑÐ»Ðµ Ñ€ÐµÑˆÐµÐ½Ð¸Ñ Ð¿Ñ€Ð¾Ð±Ð»ÐµÐ¼ SSL ÑÐµÑ€Ñ‚Ð¸Ñ„Ð¸ÐºÐ°Ñ‚ Ð±ÑƒÐ´ÐµÑ‚ ÑƒÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½, Ð¸ ÑÐ°Ð¹Ñ‚ Ð±ÑƒÐ´ÐµÑ‚ Ð´Ð¾ÑÑ‚ÑƒÐ¿ÐµÐ½ Ð¿Ð¾ HTTPS.

**Ð£Ð´Ð°Ñ‡Ð¸! ðŸš€**

